<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Orders | Astery‚Äôs Collection</title>
  <link rel="stylesheet" href="style.css" />
  
  
  <style>
    body {
      font-family: "Poppins", sans-serif;
      background: #fafafa;
      margin: 0;
      padding: 0;
    }

    header {
      background: #222;
      color: #fff;
      padding: 1rem 2rem;
      display: flex;
      justify-content: space-between;
      align-items: center;
    }

    header h1 {
      font-size: 1.5rem;
    }

    table {
      width: 90%;
      margin: 2rem auto;
      border-collapse: collapse;
      background: #fff;
      box-shadow: 0 2px 8px rgba(0,0,0,0.1);
    }

    th, td {
      padding: 1rem;
      border-bottom: 1px solid #ddd;
      text-align: left;
    }

    th {
      background: #f5f5f5;
    }

    tr:hover {
      background: #f9f9f9;
    }

    button.view-details-btn {
      background: #007bff;
      color: #fff;
      border: none;
      padding: 0.5rem 1rem;
      border-radius: 5px;
      cursor: pointer;
    }

    button.view-details-btn:hover {
      background: #0056b3;
    }

    /* Modal Styles */
    .modal {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0,0,0,0.5);
      display: flex;
      justify-content: center;
      align-items: center;
    }

    .modal-content {
      background: #fff;
      padding: 2rem;
      border-radius: 10px;
      max-width: 500px;
      width: 90%;
      position: relative;
    }

    .hidden {
      display: none;
    }

    .close-btn {
      cursor: pointer;
      position: absolute;
      top: 10px;
      right: 15px;
      font-size: 1.5rem;
      font-weight: bold;
    }

    .modal-content h3 {
      margin-top: 0;
    }

    ul#order-items-list {
      list-style: none;
      padding: 0;
    }

    ul#order-items-list li {
      padding: 0.5rem 0;
      border-bottom: 1px solid #eee;
    }

    footer {
      text-align: center;
      padding: 1rem;
      background: #222;
      color: #fff;
    }
  </style>
</head>
<body>
  

  <header>
  
    <h1>üõí Astery‚Äôs Orders</h1>
    <a href="index.html" style="color:#fff; text-decoration:none;">‚Üê Back to Shop</a>
  </header>

  <main>
    <section class="product-grid">
    <table>
  <thead>
    <tr>
      <th>Order ID</th>
      <th>Customer Name</th>
      <th>Email</th>
      <th>Shipping Method</th>
      <th>Payment Method</th>
      <th>Advance (%)</th>
      <th>Total USD</th>
      <th>Date</th>
      <th>Status</th>
      <th>Actions</th>
    </tr>
  </thead>

  <tbody id="orders-table-body">
    <!-- Orders dynamically added here -->
  </tbody>

  <tbody id="completed-orders-body">
    <!-- Completed orders dynamically added here -->
  </tbody>
</table>

<!-- Move modal OUTSIDE the table -->
<div id="order-details-modal" class="modal hidden">
  <div class="modal-content">
    <span id="close-details" class="close-btn">&times;</span>
    <div id="order-details-body"></div>
  </div>
</div>

  </main>
<script>

  
document.addEventListener("DOMContentLoaded", () => {
  
  const orders = JSON.parse(localStorage.getItem("orders")) || [];
  const tableBody = document.getElementById("orders-table-body");
  const completedBody = document.getElementById("completed-orders-body");



function renderOrders() {

          tableBody.innerHTML = "";

          if (orders.length === 0) {
            tableBody.innerHTML = `<tr><td colspan="10">No orders yet.</td></tr>`;
            return;
          }

          orders.forEach((order, index) => {
            const totalUSD = order.total ? Number(order.total).toFixed(2) : "0.00";
            const row = document.createElement("tr");

            row.innerHTML = `
              <td>${order.id}</td>
              <td>${order.customer?.name || "-"}</td>
              <td>${order.customer?.email || "-"}</td>
              <td>${order.shipping || "-"}</td>
              <td>${order.payment || "-"}</td>
              <td>${order.advance || 0}%</td>
              <td>$${totalUSD}</td>
              <td>${new Date(order.date).toLocaleDateString()}</td>
              <td>${order.status || "Pending"}</td>
              <td>
                <button class="view-details" data-index="${index}">View</button>
                <button class="complete-order" data-id="${order.id}">Complete</button>
                <button class="delete-btn" data-id="${order.id}">Delete</button>
              </td>
            `;

            tableBody.appendChild(row);
          });
      }

          
          document.addEventListener("click", e => {
                if (e.target.classList.contains("view-details")) {
                  const id = e.target.dataset.id;
                  const orders = JSON.parse(localStorage.getItem("orders")) || [];
                  const order = orders.find(o => o.id === id);
                  if (!order) return;
                 console.log(Object.entries(order));

                  const body = document.getElementById("view-details");
                  body.innerHTML = `
                    <p><strong>Order ID:</strong> ${order.id}</p>
                    <p><strong>Name:</strong> ${order.customer.name}</p>
                    <p><strong>Email:</strong> ${order.customer.email}</p>
                    <p><strong>Address:</strong> ${order.customer.address}</p>
                    <p><strong>Shipping:</strong> ${order.shipping}</p>
                    <p><strong>Payment:</strong> ${order.payment}</p>
                    <p><strong>Advance Payment:</strong> ${order.advance}%</p>
                    <p><strong>Total:</strong> $${Number(order.total).toFixed(2)}</p>
                    <h4>Items:</h4>
                    <ul>${order.items.map(i => `<li>${i.name} √ó ${i.quantity} ‚Äì $${i.price}</li>`).join("")}</ul>
                  `;

                  document.getElementById("order-details-modal").classList.remove("hidden");
                }

                if (e.target.id === "close-details") {
                  document.getElementById("order-details-modal").classList.add("hidden");
                }
              });




           document.addEventListener("click", e => {
              if (e.target.classList.contains("view-details")) {
                const index = e.target.dataset.index;
                const order = orders[index];
                if (!order) return;

                const body = document.getElementById("order-details-body");
                body.innerHTML = `
                  <p><strong>Order ID:</strong> ${order.id}</p>
                  <p><strong>Name:</strong> ${order.customer.name}</p>
                  <p><strong>Email:</strong> ${order.customer.email}</p>
                  <p><strong>Address:</strong> ${order.customer.address}</p>
                  <p><strong>Shipping:</strong> ${order.shipping}</p>
                  <p><strong>Payment:</strong> ${order.payment}</p>
                  <p><strong>Advance Payment:</strong> ${order.advance}%</p>
                  <p><strong>Total:</strong> $${Number(order.total).toFixed(2)}</p>
                  <h4>Items:</h4>
                  <ul>${order.items.map(i => `<li>${i.name} √ó ${i.quantity} ‚Äì $${i.price}</li>`).join("")}</ul>
                `;

                document.getElementById("order-details-modal").classList.remove("hidden");
              }

              if (e.target.id === "close-details") {
                document.getElementById("order-details-modal").classList.add("hidden");
              }
            });

            


            function renderCompletedOrders() {
              const completedOrders = JSON.parse(localStorage.getItem("completedOrders")) || [];
              completedBody.innerHTML = "";
              completedOrders.forEach(order => {
                const total = order.items.reduce((sum, item) => sum + item.price * item.quantity, 0);
                const row = document.createElement("tr");
                row.innerHTML = `
                  <td>${order.id}</td>
                  <td>${order.customer.name}</td>
                  <td>${order.customer.email}</td>
                  <td>$${total.toFixed(2)}</td>
                  <td>${new Date(order.date).toLocaleString()}</td>
                `;
                completedBody.appendChild(row);
              });
            }



            tableBody.addEventListener("click", (e) => {
              const index = e.target.dataset.index;
              if (e.target.classList.contains("complete-btn")) {
                const completedOrders = JSON.parse(localStorage.getItem("completedOrders")) || [];
                completedOrders.push(orders[index]);
                localStorage.setItem("completedOrders", JSON.stringify(completedOrders));
                orders.splice(index, 1);
                localStorage.setItem("orders", JSON.stringify(orders));
                renderOrders();
                renderCompletedOrders();
                alert("‚úÖ Order marked as completed.");
              }

              document.addEventListener("click", e => {
                const orders = JSON.parse(localStorage.getItem("orders")) || [];
                alert("complte orders length");
                // COMPLETE ORDER
                alert (orders.length);
                if (e.target.classList.contains("complete-btn")) {
                  const id = e.target.dataset.id;
                  const orderIndex = orders.findIndex(o => o.id === id);
                  if (orderIndex === -1) return;

                  const completedOrders = JSON.parse(localStorage.getItem("completedOrders")) || [];
                  completedOrders.push(orders[orderIndex]);
                  localStorage.setItem("completedOrders", JSON.stringify(completedOrders));

                  orders.splice(orderIndex, 1);
                  localStorage.setItem("orders", JSON.stringify(orders));

                  alert("‚úÖ Order marked as completed!");
                  location.reload(); // refresh to reflect change
                }

                // DELETE ORDER
                if (e.target.classList.contains("delete-btn")) {
                  const id = e.target.dataset.id;
                  if (confirm("Are you sure you want to delete this order?")) {
                    const updated = orders.filter(o => o.id !== id);
                    localStorage.setItem("orders", JSON.stringify(updated));
                    location.reload();
                  }
                }
     });



              if (e.target.classList.contains("delete-btn")) {
                if (confirm("Are you sure you want to delete this order?")) {
                  orders.splice(index, 1);
                  localStorage.setItem("orders", JSON.stringify(orders));
                 
                }
              }

              if (e.target.classList.contains("details-btn")) {
                const order = orders[index];
                const details = order.items.map(i => `${i.name} √ó ${i.quantity} = $${(i.price * i.quantity).toFixed(2)}`).join("\n");
                alert(`üßæ Order Details:\n\n${details}\n\nTotal: $${order.total.toFixed(2)}`);
              }
            });

  // Initial render
  renderOrders();

});

        document.addEventListener("click", e => {
          if (e.target.classList.contains("complete-order")) {
            alert("completed0orders");
            const orderId = e.target.dataset.id;
            let orders = JSON.parse(localStorage.getItem("orders")) || [];
            alert(orders.length);
            let completedOrders = JSON.parse(localStorage.getItem("completedOrders")) || [];

            const orderIndex = orders.findIndex(o => o.id === orderId);
            if (orderIndex !== -1) {
              const [completed] = orders.splice(orderIndex, 1);
              completed.status = "Completed";
              completedOrders.push(completed);

              localStorage.setItem("orders", JSON.stringify(orders));
              localStorage.setItem("completedOrders", JSON.stringify(completedOrders));

              alert(`‚úÖ Order ${orderId} marked as completed.`);
              renderPendingOrders();
              renderCompletedOrders();
            }
          }
        });

        function renderCompletedOrders() {
          const tableBody = document.getElementById("completed-orders-body");
          if (!tableBody) return;

          const completedOrders = JSON.parse(localStorage.getItem("completedOrders")) || [];
          tableBody.innerHTML = "";

          completedOrders.forEach(order => {
            const tr = document.createElement("tr");
            tr.innerHTML = `
              <td>${order.id}</td>
              <td>${order.customer.name}</td>
              <td>${order.customer.email}</td>
              <td>${order.items.length}</td>
              <td>${order.total.toFixed(2)} USD</td>
              <td>${order.status}</td>
              <td><button class="view-details" data-id="${order.id}">View</button></td>
            `;
            tableBody.appendChild(tr);
          });
        }


        document.addEventListener("DOMContentLoaded", () => {
             renderPendingOrders();
             renderCompletedOrders();
          });


</script>
</body>
</html>
